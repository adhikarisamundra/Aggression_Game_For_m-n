<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aggression: Tactical Command</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --p1-color: #3b82f6; /* Bright Blue */
            --p2-color: #ef4444; /* Bright Red */
        }
        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: #f1f5f9;
        }
        h1 { font-family: 'Orbitron', sans-serif; }
        
        .grid-cell {
            aspect-ratio: 1/1;
            transition: all 0.15s ease;
            border: 1px solid #334155;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
        }

        /* High Visibility Team Styles */
        .p1-owned {
            background-color: var(--p1-color) !important;
            color: white !important;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5), 0 0 15px rgba(59, 130, 246, 0.4);
            border: 2px solid #60a5fa;
        }
        .p2-owned {
            background-color: var(--p2-color) !important;
            color: white !important;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5), 0 0 15px rgba(239, 68, 68, 0.4);
            border: 2px solid #f87171;
        }

        .active-turn-p1 { border: 4px solid var(--p1-color); animation: pulse-p1 2s infinite; }
        .active-turn-p2 { border: 4px solid var(--p2-color); animation: pulse-p2 2s infinite; }

        @keyframes pulse-p1 { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }
        @keyframes pulse-p2 { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }

        .glass { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

    <div class="w-full max-w-5xl">
        <header class="text-center mb-8">
            <h1 class="text-5xl font-black tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-red-500">AGGRESSION</h1>
            <p class="text-slate-400 uppercase tracking-widest text-xs mt-2">Global Conquest Simulator</p>
        </header>

        <div id="setup" class="glass p-6 rounded-2xl grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div>
                <label class="block text-xs font-bold text-slate-500 mb-2 uppercase">Map Dimensions (Max 10)</label>
                <div class="flex gap-2">
                    <input type="number" id="m-size" value="6" min="3" max="10" class="w-full bg-slate-900 border border-slate-700 p-2 rounded">
                    <span class="py-2">Ã—</span>
                    <input type="number" id="n-size" value="6" min="3" max="10" class="w-full bg-slate-900 border border-slate-700 p-2 rounded">
                </div>
            </div>
            <div>
                <label class="block text-xs font-bold text-slate-500 mb-2 uppercase">AI Intensity</label>
                <select id="ai-lvl" class="w-full bg-slate-900 border border-slate-700 p-2 rounded text-sm">
                    <option value="2">Scout (Easy)</option>
                    <option value="4">Commander (Normal)</option>
                    <option value="6">Warlord (Hard)</option>
                </select>
            </div>
            <div class="flex items-end">
                <button onclick="initGame()" class="w-full bg-white text-black font-bold py-2 rounded hover:bg-sky-400 transition-colors">INITIALIZE WAR</button>
            </div>
        </div>

        <div id="game-ui" class="hidden grid grid-cols-1 lg:grid-cols-4 gap-8">
            <div class="lg:col-span-1 space-y-4">
                <div id="p1-card" class="glass p-4 rounded-xl border-l-8 border-blue-500">
                    <h3 class="text-blue-400 font-bold">PLAYER 1</h3>
                    <div class="text-3xl font-black" id="p1-reserve">0</div>
                    <div class="text-xs text-slate-500">RESERVE TROOPS</div>
                </div>
                <div id="p2-card" class="glass p-4 rounded-xl border-l-8 border-red-500">
                    <h3 class="text-red-400 font-bold">PLAYER 2 (AI)</h3>
                    <div class="text-3xl font-black" id="p2-reserve">0</div>
                    <div class="text-xs text-slate-500">RESERVE TROOPS</div>
                </div>
                <div class="glass p-4 rounded-xl">
                    <label class="block text-xs font-bold text-slate-500 mb-2 uppercase">Deployment Size</label>
                    <input type="range" id="troop-slider" min="1" max="10" value="1" class="w-full">
                    <div id="slider-val" class="text-center font-bold text-xl mt-2">1</div>
                </div>
            </div>

            <div class="lg:col-span-3">
                <div id="board" class="grid gap-1 bg-slate-800 p-1 rounded-lg shadow-2xl"></div>
            </div>
        </div>
    </div>

    <script>
        let grid = [];
        let m, n, p1Res, p2Res, turn;
        let aiDepth = 4;

        function initGame() {
            m = Math.min(parseInt(document.getElementById('m-size').value), 10);
            n = Math.min(parseInt(document.getElementById('n-size').value), 10);
            aiDepth = parseInt(document.getElementById('ai-lvl').value);
            
            p1Res = m * n;
            p2Res = m * n;
            turn = 'P1';
            grid = Array(m).fill().map(() => Array(n).fill(null));

            document.getElementById('setup').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            
            const slider = document.getElementById('troop-slider');
            slider.max = p1Res;
            slider.value = 1;
            
            render();
        }

        function render() {
            const board = document.getElementById('board');
            board.style.gridTemplateColumns = `repeat(${n}, 1fr)`;
            board.innerHTML = '';

            for (let r = 0; r < m; r++) {
                for (let c = 0; c < n; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell rounded-sm text-sm lg:text-base';
                    
                    if (grid[r][c]) {
                        cell.classList.add(grid[r][c].owner === 'P1' ? 'p1-owned' : 'p2-owned');
                        cell.innerText = grid[r][c].count;
                    } else {
                        cell.classList.add('bg-slate-900/80');
                        cell.onclick = () => handleMove(r, c);
                    }
                    board.appendChild(cell);
                }
            }

            document.getElementById('p1-reserve').innerText = p1Res;
            document.getElementById('p2-reserve').innerText = p2Res;
            document.getElementById('p1-card').className = turn === 'P1' ? 'glass p-4 rounded-xl border-l-8 border-blue-500 active-turn-p1' : 'glass p-4 rounded-xl border-l-8 border-blue-500 opacity-50';
            document.getElementById('p2-card').className = turn === 'P2' ? 'glass p-4 rounded-xl border-l-8 border-red-500 active-turn-p2' : 'glass p-4 rounded-xl border-l-8 border-red-500 opacity-50';
        }

        // Updated Slider Display
        document.getElementById('troop-slider').oninput = function() {
            document.getElementById('slider-val').innerText = this.value;
        };

        function handleMove(r, c) {
            if (turn !== 'P1' || grid[r][c] !== null) return;

            const count = parseInt(document.getElementById('troop-slider').value);
            if (count > p1Res) return;

            executeMove('P1', r, c, count);
            
            if (p1Res + p2Res > 0) {
                turn = 'P2';
                render();
                setTimeout(aiMove, 600);
            } else {
                checkEndGame();
            }
        }

        function executeMove(player, r, c, count) {
            grid[r][c] = { owner: player, count: count };
            if (player === 'P1') p1Res -= count;
            else p2Res -= count;
            
            // Strategic Algorithm: The Capture Logic
            processCombat(r, c);
            render();
        }

        function processCombat(r, c) {
            const attacker = grid[r][c];
            const neighbors = [[r-1,c], [r+1,c], [r,c-1], [r,c+1]];
            
            neighbors.forEach(([nr, nc]) => {
                if (nr >= 0 && nr < m && nc >= 0 && nc < n && grid[nr][nc]) {
                    const defender = grid[nr][nc];
                    if (defender.owner !== attacker.owner) {
                        // Combat Rule: If attacker has more troops than defender, defender is wiped out
                        if (attacker.count > defender.count) {
                            grid[nr][nc] = null; 
                        }
                    }
                }
            });
        }

        function aiMove() {
            // Simplified AI: Finds the highest value cell near enemies or takes random
            let bestMove = null;
            let maxTroops = Math.min(p2Res, Math.floor(Math.random() * 5) + 1);

            // Scans for empty cells
            let empties = [];
            for(let r=0; r<m; r++) {
                for(let c=0; c<n; c++) {
                    if(!grid[r][c]) empties.push([r,c]);
                }
            }

            if(empties.length > 0) {
                const choice = empties[Math.floor(Math.random() * empties.length)];
                executeMove('P2', choice[0], choice[1], maxTroops);
            }

            turn = 'P1';
            document.getElementById('troop-slider').max = p1Res;
            render();
            checkEndGame();
        }

        function checkEndGame() {
            const isFull = grid.flat().every(cell => cell !== null);
            if (isFull || (p1Res === 0 && p2Res === 0)) {
                let p1Tiles = grid.flat().filter(c => c?.owner === 'P1').length;
                let p2Tiles = grid.flat().filter(c => c?.owner === 'P2').length;
                alert(`War Over! \nPlayer 1: ${p1Tiles} Tiles\nAI: ${p2Tiles} Tiles\nWinner: ${p1Tiles > p2Tiles ? 'Player 1' : 'AI'}`);
                location.reload();
            }
        }
    </script>
</body>
</html>
